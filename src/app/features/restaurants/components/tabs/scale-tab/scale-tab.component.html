<div class="p-4">
  <!-- Header with Add Button -->
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">
      Escalas de Cobro por Distancia
    </h3>
    <p-button
      label="Nueva Escala"
      icon="pi pi-plus"
      (onClick)="openCreateDialog()"
      [disabled]="isLoading()"
    />
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="flex items-center justify-center py-12">
      <i class="pi pi-spin pi-spinner text-4xl text-primary"></i>
    </div>
  } @else if (scales().length === 0) {
    <!-- Empty State -->
    <div class="text-center py-12">
      <i class="pi pi-chart-line text-6xl text-gray-300 mb-4"></i>
      <p class="text-gray-600 dark:text-gray-400 mb-4">
        No hay escalas configuradas
      </p>
      <p class="text-sm text-gray-500 mb-6">
        Agregue escalas de cobro para configurar los precios de entrega seg√∫n la distancia
      </p>
      <p-button
        label="Agregar Primera Escala"
        icon="pi pi-plus"
        (onClick)="openCreateDialog()"
      />
    </div>
  } @else {
    <!-- Scales Table -->
    <p-table
      [value]="scalesWithRange()"
      [tableStyle]="{ 'min-width': '50rem' }"
      class="p-datatable-sm"
      [rowHover]="true"
    >
      <ng-template #header>
        <tr>
          <th class="text-left">Rango de Distancia</th>
          <th class="text-right">Cobro Cliente</th>
          <th class="text-right">Pago Delivery</th>
          <th class="text-center">Estado</th>
          <th class="text-center" style="width: 150px">Acciones</th>
        </tr>
      </ng-template>
      <ng-template #body let-scale>
        <tr>
          <td class="text-left">
            <div class="flex items-center gap-2">
              <i class="pi pi-map-marker text-primary"></i>
              <span class="font-medium">{{ scale.rangeDisplay }}</span>
            </div>
          </td>
          <td class="text-right">
            <span class="font-semibold text-green-600">
              {{ formatCurrency(scale.customerCharge) }}
            </span>
          </td>
          <td class="text-right">
            <span class="font-semibold text-blue-600">
              {{ formatCurrency(scale.deliveryPayment) }}
            </span>
          </td>
          <td class="text-center">
            <p-toggleSwitch
              [ngModel]="scale.active"
              (ngModelChange)="toggleScaleStatus(scale)"
              [ngModelOptions]="{standalone: true}"
            />
          </td>
          <td class="text-center">
            <div class="flex justify-center gap-2">
              <p-button
                icon="pi pi-pencil"
                [outlined]="true"
                severity="secondary"
                size="small"
                (onClick)="openEditDialog(scale)"
                [title]="'Editar'"
              />
              <p-button
                icon="pi pi-trash"
                [outlined]="true"
                severity="danger"
                size="small"
                (onClick)="deleteScale(scale)"
                [title]="'Eliminar'"
              />
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template #emptymessage>
        <tr>
          <td colspan="5" class="text-center py-8">
            <p class="text-gray-500">No se encontraron escalas</p>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Summary Info -->
    <div class="mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
      <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
        <i class="pi pi-info-circle"></i>
        <span>Total de escalas: <strong>{{ scales().length }}</strong></span>
        <span class="mx-2">|</span>
        <span>Activas: <strong>{{ activeScalesCount() }}</strong></span>
      </div>
    </div>
  }

  <!-- Scale Dialog -->
  @if (showDialog()) {
    <app-scale-dialog
      [visible]="showDialog()"
      [mode]="dialogMode()"
      [scale]="selectedScale()"
      [restaurantId]="restaurantId()"
      (onClose)="onDialogClose()"
      (onSave)="onScaleSaved()"
    />
  }

  <!-- Confirmation Dialog -->
  <p-confirmDialog />
</div>
