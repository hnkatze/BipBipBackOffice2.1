<div class="container mx-auto px-4 py-6 md:py-8">
  <!-- Breadcrumb -->
  <p-breadcrumb
    [model]="breadcrumbs"
    styleClass="mb-6 md:mb-8"
  ></p-breadcrumb>

  <!-- Toast -->
  <p-toast />

  <!-- Header -->
  <div class="mb-6 md:mb-8">
    <h1 class="text-2xl md:text-3xl font-bold text-surface-900 dark:text-surface-50">
      Premiaciones
    </h1>
    <p class="mt-2 text-xs md:text-sm text-surface-600 dark:text-surface-400">
      Genera reportes de premiaciones filtrados por fechas, marcas y ciudades
    </p>
  </div>

  <!-- Filters Card -->
  <p-card styleClass="shadow-sm">
    <ng-template pTemplate="header">
      <div class="px-6 pt-6 pb-4 border-b border-surface-200 dark:border-surface-700">
        <h2 class="text-lg font-semibold text-surface-900 dark:text-surface-50 flex items-center gap-2">
          <i class="pi pi-filter text-[#fb0021]"></i>
          Filtros de Reporte
        </h2>
      </div>
    </ng-template>

    <form [formGroup]="filterForm" class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <!-- Rango de Fechas -->
        <div class="md:col-span-2">
          <label
            for="dateRange"
            class="text-sm font-medium text-surface-700 dark:text-surface-300 mb-2 block flex items-center gap-1"
          >
            <i class="pi pi-calendar text-[#fb0021]"></i>
            <span>Rango de Fechas</span>
            <span class="text-red-500 dark:text-red-400">*</span>
          </label>
          <p-datepicker
            inputId="dateRange"
            formControlName="dateRange"
            [showIcon]="true"
            [iconDisplay]="'input'"
            dateFormat="dd/mm/yy"
            placeholder="Selecciona rango de fechas"
            selectionMode="range"
            [readonlyInput]="true"
            styleClass="w-full"
          ></p-datepicker>
          @if (getErrorMessage('dateRange')) {
            <small class="text-red-500 dark:text-red-400 mt-1 block">
              {{ getErrorMessage('dateRange') }}
            </small>
          }
        </div>

        <!-- Marcas -->
        <div>
          <label
            for="brandIds"
            class="text-sm font-medium text-surface-700 dark:text-surface-300 mb-2 block"
          >
            Marcas
            <span class="text-red-500 dark:text-red-400">*</span>
          </label>
          <p-multiselect
            inputId="brandIds"
            formControlName="brandIds"
            [options]="brands()"
            optionLabel="name"
            optionValue="id"
            placeholder="Selecciona marcas"
            [filter]="true"
            filterPlaceholder="Buscar marca..."
            [showClear]="true"
            styleClass="w-full"
            appendTo="body"
          >
            <ng-template let-brand pTemplate="item">
              <div class="flex items-center gap-3">
                @if (brand.logo) {
                  <img
                    [src]="brand.logo"
                    [alt]="brand.name"
                    class="w-8 h-8 rounded object-cover"
                  />
                }
                <span>{{ brand.name }}</span>
              </div>
            </ng-template>
          </p-multiselect>
          @if (getErrorMessage('brandIds')) {
            <small class="text-red-500 dark:text-red-400 mt-1 block">
              {{ getErrorMessage('brandIds') }}
            </small>
          }
        </div>

        <!-- Ciudades -->
        <div>
          <label
            for="cityIds"
            class="text-sm font-medium text-surface-700 dark:text-surface-300 mb-2 block"
          >
            Ciudades
            <span class="text-red-500 dark:text-red-400">*</span>
          </label>
          <p-multiselect
            inputId="cityIds"
            formControlName="cityIds"
            [options]="cities()"
            optionLabel="name"
            optionValue="id"
            placeholder="Selecciona ciudades"
            [filter]="true"
            filterPlaceholder="Buscar ciudad..."
            [showClear]="true"
            styleClass="w-full"
            appendTo="body"
          ></p-multiselect>
          @if (getErrorMessage('cityIds')) {
            <small class="text-red-500 dark:text-red-400 mt-1 block">
              {{ getErrorMessage('cityIds') }}
            </small>
          }
        </div>

        <!-- Límite de Registros -->
        <div class="md:col-span-2">
          <label
            for="recordLimit"
            class="text-sm font-medium text-surface-700 dark:text-surface-300 mb-2 block"
          >
            Límite de Registros (Opcional)
          </label>
          <p-inputnumber
            inputId="recordLimit"
            formControlName="recordLimit"
            [min]="1"
            [max]="10000"
            placeholder="Ej: 100 (deja vacío para todos)"
            [showButtons]="true"
            [step]="10"
            styleClass="w-full"
          ></p-inputnumber>
          <small class="text-surface-500 dark:text-surface-400 mt-1 block">
            Limita la cantidad de registros en el reporte (entre 1 y 10,000). Deja vacío para incluir todos.
          </small>
          @if (getErrorMessage('recordLimit')) {
            <small class="text-red-500 dark:text-red-400 mt-1 block">
              {{ getErrorMessage('recordLimit') }}
            </small>
          }
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-3 pt-4 border-t border-surface-200 dark:border-surface-700">
        <button
          pButton
          label="Descargar Reporte Excel"
          icon="pi pi-file-excel"

          (click)="generateReport()"
          [disabled]="filterForm.invalid || generating()"
          [loading]="generating()"
          styleClass="flex-1 md:flex-initial"
        ></button>
        <button
          pButton
          label="Limpiar Filtros"
          icon="pi pi-filter-slash"
          severity="secondary"
          [text]="true"
          (click)="clearFilters()"
          [disabled]="generating()"
          styleClass="flex-1 md:flex-initial"
        ></button>
      </div>
    </form>
  </p-card>
</div>
