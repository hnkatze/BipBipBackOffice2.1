<div class="w-full min-h-screen bg-surface-50 dark:bg-surface-950 p-4 md:p-6">
  <!-- Toast Notifications -->
  <p-toast />

  <!-- Breadcrumb Navigation -->
  <p-breadcrumb [model]="breadcrumbs" styleClass="mb-4 md:mb-6"></p-breadcrumb>

  <!-- Header -->
  <div class="mb-6 md:mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold text-surface-900 dark:text-surface-50">
          Planilla Correlativo
        </h1>
        <p class="mt-2 text-xs md:text-sm text-surface-600 dark:text-surface-400">
          Gestiona el número correlativo para las planillas de pago
        </p>
      </div>
    </div>
  </div>

  <!-- Content Card -->
  <p-card>
    <ng-template pTemplate="header">
      <div class="border-l-4 border-[#fb0021] pl-4 py-4">
        <h3 class="text-lg font-semibold text-surface-900 dark:text-surface-50">
          Correlativo Actual
        </h3>
        <p class="text-sm text-surface-600 dark:text-surface-400 mt-1">
          Este número se utiliza para identificar las planillas de pago de manera secuencial
        </p>
      </div>
    </ng-template>

    <!-- Loading State -->
    @if (loading()) {
      <div class="flex flex-col items-center justify-center py-16">
        <i class="pi pi-spin pi-spinner text-6xl text-blue-600 mb-4"></i>
        <p class="text-surface-600 dark:text-surface-400">Cargando correlativo...</p>
      </div>
    }

    <!-- Error State -->
    @else if (error() && !loading()) {
      <div class="p-6 text-center">
        <div class="inline-flex flex-col items-center gap-3 px-6 py-4 bg-red-50 dark:bg-red-950/30 text-red-700 dark:text-red-400 rounded-lg">
          <i class="pi pi-exclamation-circle text-4xl"></i>
          <span class="text-sm">{{ error() }}</span>
          <button
            pButton
            label="Reintentar"
            icon="pi pi-refresh"
            severity="danger"
            (click)="loadCorrelative()"
            class="mt-2"
          ></button>
        </div>
      </div>
    }

    <!-- Content -->
    @else if (correlative() !== null) {
      <div class="p-6">
        <!-- Display Mode (Read-only) -->
        @if (!isEditing()) {
          <div class="bg-surface-0 dark:bg-surface-900 border border-surface-200 dark:border-surface-700 rounded-lg p-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
              <div class="flex-1">
                <label class="text-sm font-medium text-surface-600 dark:text-surface-400 uppercase block mb-2">
                  Número Correlativo
                </label>
                <div class="flex items-center gap-3">
                  <i class="pi pi-hashtag text-3xl text-[#fb0021]"></i>
                  <span class="text-4xl font-bold text-surface-900 dark:text-surface-50">
                    {{ correlative() }}
                  </span>
                </div>
                <p class="text-xs text-surface-500 dark:text-surface-400 mt-2">
                  Este valor se incrementa automáticamente con cada planilla generada
                </p>
              </div>

              <div>
                <button
                  pButton
                  label="Editar"
                  icon="pi pi-pencil"
                  severity="secondary"
                  (click)="enableEdit()"
                  [outlined]="true"
                ></button>
              </div>
            </div>
          </div>
        }

        <!-- Edit Mode -->
        @else {
          <div class="bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg p-6">
            <div class="mb-4">
              <label class="text-sm font-medium text-surface-700 dark:text-surface-300 block mb-2 flex items-center gap-1">
                <i class="pi pi-hashtag text-[#fb0021]"></i>
                <span>Nuevo Correlativo</span>
                <span class="text-red-500 dark:text-red-400">*</span>
              </label>

              <p-inputNumber
                [formControl]="correlativeControl"
                [min]="1"
                [showButtons]="true"
                buttonLayout="horizontal"
                incrementButtonIcon="pi pi-plus"
                decrementButtonIcon="pi pi-minus"
                styleClass="w-full md:w-80"
                placeholder="Ingresa el nuevo correlativo"
              />

              @if (correlativeControl.invalid && correlativeControl.touched) {
                <span class="text-xs text-red-500 dark:text-red-400 mt-1 block">
                  El correlativo debe ser un número mayor a 0
                </span>
              }

              <p class="text-xs text-surface-600 dark:text-surface-400 mt-2">
                ⚠️ Cambiar el correlativo puede afectar la numeración de las siguientes planillas
              </p>
            </div>

            <div class="flex items-center gap-3 pt-4 border-t border-blue-200 dark:border-blue-800">
              <button
                pButton
                label="Cancelar"
                icon="pi pi-times"
                severity="secondary"
                (click)="cancelEdit()"
                [outlined]="true"
                [disabled]="saving()"
              ></button>

              <button
                pButton
                [label]="saving() ? 'Guardando...' : 'Guardar'"
                icon="pi pi-check"
                severity="danger"
                (click)="saveCorrelative()"
                [disabled]="saving() || correlativeControl.invalid || !hasChanges()"
                [loading]="saving()"
              ></button>
            </div>
          </div>
        }

        <!-- Info Card -->
        <div class="bg-surface-0 dark:bg-surface-950 border border-surface-200 dark:border-surface-700 rounded-lg p-4 mt-4">
          <div class="flex items-start gap-2">
            <i class="pi pi-info-circle text-blue-600 dark:text-blue-400 mt-0.5"></i>
            <div class="flex-1">
              <p class="text-xs font-medium text-surface-900 dark:text-surface-50">Información Importante</p>
              <ul class="text-xs text-surface-600 dark:text-surface-400 mt-1 space-y-0.5 list-disc list-inside">
                <li>El correlativo se utiliza para numerar las planillas de manera secuencial</li>
                <li>Cada vez que se genera una planilla, este número se incrementa automáticamente</li>
                <li>Solo modifica este valor si es necesario corregir la numeración</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    }

    <!-- Empty State (No correlative) -->
    @else if (!loading() && !error() && correlative() === null) {
      <div class="p-12 text-center">
        <i class="pi pi-inbox text-6xl text-surface-400 dark:text-surface-600 mb-4"></i>
        <h3 class="text-lg font-semibold text-surface-700 dark:text-surface-300 mb-2">
          No hay correlativo configurado
        </h3>
        <p class="text-surface-500 dark:text-surface-400">
          Aún no se ha configurado un correlativo para las planillas
        </p>
      </div>
    }
  </p-card>
</div>
